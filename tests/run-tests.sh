#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘        ğŸ§ª MOOC API æ™ºèƒ½åŒ–æµ‹è¯•æ¡†æ¶ v1.0                    â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

echo ""
echo "ğŸ“‹ æ£€æŸ¥åº”ç”¨çŠ¶æ€..."

APP_URL="http://localhost:8080/health"

if curl -s --head "$APP_URL" | head -n 1 | grep "200 OK" > /dev/null; then
    echo "âœ… åº”ç”¨è¿è¡Œæ­£å¸¸"
else
    echo "âŒ åº”ç”¨æœªè¿è¡Œï¼Œè¯·å…ˆå¯åŠ¨åº”ç”¨ï¼š"
    echo "   cd mooc-class && mvn spring-boot:run"
    exit 1
fi

echo ""
echo "ğŸ“¦ å®‰è£…æµ‹è¯•ä¾èµ–..."
cd "$(dirname "$0")"
npm install

echo ""
echo "ğŸš€ å¼€å§‹æ‰§è¡Œæµ‹è¯•..."
node smart-test-runner.js

exit $?
